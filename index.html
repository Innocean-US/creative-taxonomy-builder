<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Campaign Taxonomy Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    max-width: 900px;
    margin: 2rem auto;
    padding: 0 1rem;
  }
  h1 { font-size: 1.6rem; margin-bottom: 0.5rem; }
  h2 { font-size: 1.2rem; margin-top: 1.75rem; }
  .field-group {
    display: flex;
    gap: 1rem;
    align-items: center;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }
  label { min-width: 160px; font-weight: 600; }
  select, input[type="text"] { min-width: 220px; padding: 0.25rem 0.5rem; }
  button { padding: 0.35rem 0.75rem; }
  .hidden { display: none; }
  .error { color: #b00020; font-size: 0.85rem; }
  .code-output {
    margin-top: 2rem;
    padding: 1rem;
    border: 1px solid #ccc;
    background: #f9f9f9;
    border-radius: 6px;
  }
  code { font-weight: 600; font-size: 1.1rem; word-break: break-all; }
</style>
</head>

<body>

<h1>Campaign Taxonomy Builder</h1>
<p>Select values below. The tool generates a deterministic taxonomy string.</p>

<!-- REGION -->
<div class="field-group">
  <label>Region</label>
  <select id="region">
    <option value="">-- Select --</option>
    <option value="ALR">All Regions</option>
    <option value="CEN">Central</option>
    <option value="EAS">East</option>
  </select>
</div>

<!-- MEDIA -->
<div class="field-group">
  <label>Media</label>
  <select id="media" disabled>
    <option value="">-- Select --</option>
    <option value="IMV">Programmatic Video</option>
    <option value="DIS">Display</option>
  </select>
</div>

<!-- INITIATIVE -->
<div class="field-group">
  <label>Initiative</label>
  <select id="initiative" disabled>
    <option value="">-- Select --</option>
    <option value="WGSE">Winter Getaway Sales Event</option>
    <option value="CRCH">Cross-Channel</option>
  </select>
</div>

<!-- TITLE -->
<div class="field-group">
  <label>Title</label>
  <select id="title" disabled>
    <option value="">-- Select --</option>
  </select>
</div>

<!-- MODEL MODE -->
<div class="field-group hidden" id="modelModeGroup">
  <label>Model Selection</label>
  <label><input type="radio" name="modelMode" value="single" checked> Single</label>
  <label><input type="radio" name="modelMode" value="multiple"> Multiple</label>
</div>

<!-- SINGLE MODEL -->
<div id="singleModelBlock">
  <div class="field-group">
    <label>Model Year</label>
    <select id="model_year" disabled>
      <option value="">-- Select --</option>
      <option value="MY24">MY24</option>
      <option value="MY25">MY25</option>
    </select>
  </div>
  <div class="field-group">
    <label>Model</label>
    <select id="model_name" disabled>
      <option value="">-- Select --</option>
      <option value="TUC">Tucson</option>
      <option value="ION">Ioniq 5 N</option>
      <option value="PAL">Palisade</option>
    </select>
  </div>
</div>

<!-- MULTI MODEL -->
<div id="multiModelBlock" class="hidden">
  <h2>Models</h2>
  <div id="multiModelRows"></div>
  <button type="button" id="addModelBtn">Add Model</button>
  <div id="modelError" class="error"></div>
</div>

<!-- OUTPUT -->
<div class="code-output">
  <strong>Generated Taxonomy String</strong><br>
  <code id="taxonomyCode">(select values above)</code>
</div>

<script>
/* ---------------- TITLES ---------------- */

const ALL_TITLES = {
  NA: "Not Applicable",
  LLW: "Lay Low",
  EPIC: "Epic Afternoon"
};

const INITIATIVE_TITLE_MAP = {
  WGSE: ["LLW"],
  CRCH: ["EPIC"]
};

function populateTitleOptions() {
  const init = initiative.value;
  title.innerHTML = "<option value=''>-- Select --</option>";

  if (!INITIATIVE_TITLE_MAP[init]) return;

  INITIATIVE_TITLE_MAP[init].forEach(code => {
    const opt = document.createElement("option");
    opt.value = code;
    opt.textContent = ALL_TITLES[code];
    title.appendChild(opt);
  });
}

/* ---------------- MODEL ROW FACTORY ---------------- */

function createModelRow(lockYear = null) {
  const row = document.createElement("div");
  row.className = "field-group";

  row.innerHTML = `
    <select class="mm-year">
      <option value="">MY</option>
      <option value="MY24">MY24</option>
      <option value="MY25">MY25</option>
    </select>
    <select class="mm-name">
      <option value="">Model</option>
      <option value="TUC">Tucson</option>
      <option value="ION">Ioniq 5 N</option>
      <option value="PAL">Palisade</option>
    </select>
    <button type="button">Delete</button>
  `;

  const yearSel = row.querySelector(".mm-year");
  const modelSel = row.querySelector(".mm-name");

  if (lockYear) {
    yearSel.value = lockYear;
    yearSel.disabled = true;
  }

  row.querySelector("button").onclick = () => {
    row.remove();
    updateTaxonomy();
  };

  yearSel.onchange = modelSel.onchange = updateTaxonomy;

  return row;
}

/* ---------------- MODEL MODE ---------------- */

document.querySelectorAll("input[name='modelMode']").forEach(r => {
  r.onchange = e => {
    if (e.target.value === "multiple") {
      singleModelBlock.classList.add("hidden");
      multiModelBlock.classList.remove("hidden");
      multiModelRows.innerHTML = "";
      multiModelRows.appendChild(createModelRow());
    } else {
      multiModelBlock.classList.add("hidden");
      singleModelBlock.classList.remove("hidden");
      modelError.textContent = "";
    }
    updateTaxonomy();
  };
});

addModelBtn.onclick = () => {
  const firstYear = multiModelRows.querySelector(".mm-year")?.value || null;
  multiModelRows.appendChild(createModelRow(firstYear));
};

/* ---------------- TAXONOMY ---------------- */

function updateTaxonomy() {
  modelError.textContent = "";

  const parts = [];
  ["region","media","initiative","title"].forEach(id => {
    if (window[id].value) parts.push(window[id].value);
  });

  const mode = document.querySelector("input[name='modelMode']:checked").value;

  if (mode === "multiple") {
    const combos = [];
    const seen = new Set();
    let enforcedYear = null;

    multiModelRows.querySelectorAll(".field-group").forEach(row => {
      const y = row.querySelector(".mm-year").value;
      const m = row.querySelector(".mm-name").value;
      if (!y || !m) return;

      if (!enforcedYear) enforcedYear = y;
      if (y !== enforcedYear) {
        modelError.textContent = "All models must use the same Model Year.";
        taxonomyCode.textContent = "(validation error)";
        return;
      }

      const key = y + m;
      if (seen.has(key)) {
        modelError.textContent = "Duplicate model selections are not allowed.";
        row.querySelector(".mm-name").value = "";
        taxonomyCode.textContent = "(validation error)";
        return;
      }

      seen.add(key);
      combos.push(key);
    });

    if (combos.length < 2) {
      modelError.textContent = "Select at least two models.";
      taxonomyCode.textContent = "(select at least two models)";
      return;
    }

    parts.push(combos.join("|"));
  } else {
    if (model_year.value && model_name.value) {
      parts.push(model_year.value + model_name.value);
    }
  }

  taxonomyCode.textContent = parts.join("_");
}

/* ---------------- LOCKING ---------------- */

function updateLocks() {
  media.disabled = !region.value;
  initiative.disabled = !media.value;
  title.disabled = !initiative.value;
  modelModeGroup.classList.toggle("hidden", !title.value);
  model_year.disabled = !title.value;
  model_name.disabled = !model_year.value;
}

["region","media","initiative","title","model_year","model_name"].forEach(id => {
  window[id].addEventListener("change", () => {
    if (id === "initiative") populateTitleOptions();
    updateLocks();
    updateTaxonomy();
  });
});

updateLocks();
</script>

</body>
</html>
