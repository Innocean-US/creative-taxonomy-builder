<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Campaign Taxonomy Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    h1 {
      font-size: 1.6rem;
      margin-bottom: 0.5rem;
    }
    h2 {
      font-size: 1.2rem;
      margin-top: 2rem;
      margin-bottom: 0.5rem;
    }
    .field-group {
      margin-bottom: 1rem;
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }
    label {
      min-width: 160px;
      font-weight: 600;
    }
    select {
      min-width: 220px;
      padding: 0.25rem 0.5rem;
    }
    input[type="text"],
    input[type="number"] {
      padding: 0.25rem 0.5rem;
    }
    .code-output {
      margin-top: 2rem;
      padding: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #f9f9f9;
    }
    .code-output code {
      font-size: 1.1rem;
      font-weight: 600;
      word-break: break-all;
    }
    .hint {
      font-size: 0.85rem;
      color: #666;
      margin-top: 0.25rem;
    }
    .offer-builder {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .segment-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.5rem;
      align-items: center;
    }
    .segment-label {
      min-width: 80px;
      font-weight: 600;
    }
    .operator-select {
      min-width: 70px;
    }
    .inline-hint {
      font-size: 0.8rem;
      color: #777;
    }
  </style>
</head>
<body>
  <h1>Campaign Taxonomy Builder</h1>
  <p>Select values below. The tool will generate the full taxonomy string.</p>

  <!-- REGION -->
  <div class="field-group">
    <label for="region">Region</label>
    <select id="region">
      <option value="">-- Select Region --</option>
      <option value="ALR">All Regions</option>
      <option value="CEN">Central</option>
      <option value="EAS">East</option>
      <option value="MAT">Mid-Atlantic</option>
      <option value="MTN">Mountain</option>
      <option value="SCR">South Central</option>
      <option value="SOU">South</option>
      <!-- <option value="NAT">National</option> -->
    </select>
  </div>

  <!-- MEDIA TYPE -->
  <div class="field-group">
    <label for="media">Media Type</label>
    <select id="media">
      <option value="">-- Select Channel --</option>
      <option value="NIMV">Broadcast Spots</option>
      <option value="IMV">Programmatic Video</option>
      <option value="DIS">Display</option>
      <option value="MLA">Meta Static Link Ad</option>
      <option value="MMPA">Meta Carousel Ad</option>
      <option value="MVA">Meta Video Ad </option>
      <option value="AUD">Streaming Audio</option>
    </select>
  </div>

  <!-- INITIATIVE / CAMPAIGN -->
  <div class="field-group">
    <label for="initiative">Initiative / Campaign</label>
    <select id="initiative">
      <option value="">-- Select Initiative --</option>
      <option value="25PROMO">2025 Promo Period Creative</option>
      <option value="SPGSE">Spring Getaway Sales Event</option>
      <option value="SGSE">Summer Getaway Sales Event</option>
      <option value="WGSE">Winter Getaway Sales Event</option>
      <option value="WIN">Wins Every Time VS Campaign</option>
      <option value="CUA">Customer Assurance</option>
      <option value="BRD">Brand</option>
      <option value="EVE">Evergreen</option>
      <option value="EVECON">Evergreen Conquest</option>
      <option value="EVERET">Evergreen Retention</option>
    </select>
  </div>

  <!-- TITLE -->
  <div class="field-group">
    <label for="title">Title</label>
    <select id="title">
      <option value="">-- Select Title --</option>
      <option value="NA">Not Applicable</option>
      <option value="LLW">Lay Low</option>
      <option value="CNF">Confession</option>
      <option value="CPT">Couple's Therapy</option>
      <option value="LWF">Lawyer Friend</option>
      <option value="DAD">Dad Santa</option>
      <option value="COP">Mall Cop</option>
      <option value="TOW">The Tow</option>
      <option value="NLBR1">No Looking Back R1</option>
      <option value="WFH">Work From Home</option>
      <option value="DIN">Diner</option>
      <option value="DGL">Dog Life R1</option>
      <option value="WAP">Watch Party</option>
      <option value="SHD">Shade</option>
      <option value="HOM">Home</option>
      <option value="COL">College</option>
      <option value="BYA">Booya</option>
      <option value="SLG">Short Long R2</option>
      <option value="ROC">Rock Out</option>
      <option value="RLF">Real Friends</option>
      <option value="SOF">Stand Off</option>
      <option value="ATM">All That &amp; More</option>
      <option value="TRD">The Road</option>
      <option value="VSCivic">Elantra VS Civic</option>
      <option value="VSCorolla">Elantra VS Corolla</option>
      <option value="VSSentra">Elantra VS Sentra</option>
      <option value="VSCorollaHybrid">Elantra Hybrid VS Corolla Hybrid</option>
      <option value="VSAccordHybrid">Elantra Hybrid VS Accord Hybrid</option>
      <option value="VSID.4">Ioniq 5 VS ID.4</option>
      <option value="VSMach-E">Ioniq 5 VS Mach-E</option>
      <option value="VSAriya">Ioniq 5 VS Ariya</option>
      <option value="VSbZ4X">Ioniq 5 VS bZ4X</option>
      <option value="VSModelY">Ioniq 5 VS Model Y</option>
      <option value="VSPrologue">Ioniq 5 VS Prologue</option>
      <option value="VSID.4">Ioniq 6 VS ID.4</option>
      <option value="VSPolestar2">Ioniq 6 VS Polestar 2</option>
      <option value="VSModel3">Ioniq 6 VS Model 3</option>
      <option value="VSC-HR">Kona VS C-HR</option>
      <option value="VSHR-V">Kona VS HR-V</option>
      <option value="VSRenegade">Kona VS Renegade</option>
      <option value="VSCrosstrek">Kona VS Crosstrek</option>
      <option value="VSCorollaCross">Kona VS Corolla Cross</option>
      <option value="VSTrailblazer">Kona VS Trailblazer</option>
      <option value="VSTrax">Kona VS Trax</option>
      <option value="VSLeaf">Kona EV VS Leaf</option>
      <option value="VSMini">Kona EV VS Mini</option>
      <option value="VSBolt">Kona EV VS Bolt</option>
      <option value="VSClarityFC">Nexo VS Clarity FC</option>
      <option value="VSMirai">Nexo VS Mirai</option>
      <option value="VSModelY">Nexo VS Model Y</option>
      <option value="VSExplorer">Palisade VS Explorer</option>
      <option value="VSHighlander">Palisade VS Highlander</option>
      <option value="VSPilot">Palisade VS Pilot</option>
      <option value="VSGrandCherokee">Palisade VS Grand Cherokee</option>
      <option value="VSTraverse">Palisade VS Traverse</option>
      <option value="VSPathfinder">Palisade VS Pathfinder</option>
      <option value="VSMaverick">Santa Cruz VS Maverick</option>
      <option value="VSOutback">Santa Cruz VS Outback</option>
      <option value="VSRidgeline">Santa Cruz VS Ridgeline</option>
      <option value="VSMurano">Santa Fe VS Murano</option>
      <option value="VSOutback">Santa Fe VS Outback</option>
      <option value="VSPassport">Santa Fe VS Passport</option>
      <option value="VSHighlander">Santa Fe VS Highlander</option>
      <option value="VSBlazer">Santa Fe VS Blazer</option>
      <option value="VSRAV4Hybrid">Santa Fe Hybrid VS RAV4 Hybrid</option>
      <option value="VSCR-VHybrid">Santa Fe Hybrid VS CR-V Hybrid</option>
      <option value="VSEscapeHybrid">Santa Fe Hybrid VS Escape Hybrid</option>
      <option value="VSEscapePHEV">Santa Fe PHEV VS Escape PHEV</option>
      <option value="VSOutlanderPHEV">Santa Fe PHEV VS Outlander PHEV</option>
      <option value="VSRAV4PHEV">Santa Fe PHEV VS RAV4 PHEV</option>
      <option value="VSAccord">Sonata VS Accord</option>
      <option value="VSAltima">Sonata VS Altima</option>
      <option value="VSCamry">Sonata VS Camry</option>
      <option value="VSAccordHybrid">Sonata Hybrid VS Accord Hybrid</option>
      <option value="VSCamryHybrid">Sonata Hybrid VS Camry Hybrid</option>
      <option value="VSCR-V">Tucson VS CR-V</option>
      <option value="VSRAV4">Tucson VS RAV4</option>
      <option value="VSRogue">Tucson VS Rogue</option>
      <option value="VSForester">Tucson VS Forester</option>
      <option value="VSEquinox">Tucson VS Equinox</option>
      <option value="VSEscape">Tucson VS Escape</option>
      <option value="VSCR-VHybrid">Tucson Hybrid VS CR-V Hybrid</option>
      <option value="VSRAV4Hybrid">Tucson Hybrid VS RAV4 Hybrid</option>
      <option value="VSEscapeHybrid">Tucson Hybrid VS Escape Hybrid</option>
      <option value="VSRAV4PHEV">Tucson PHEV VS RAV4 PHEV</option>
      <option value="VSEscapePHEV">Tucson PHEV VS Escape PHEV</option>
      <option value="VSModelX">Ioniq 9 VS Model X</option>
      <option value="VSR1S">Ioniq 9 VS R1S</option>
      <option value="HYW">The Hyundai Way</option>
      <option value="BTR">Brand The Road</option>
      <option value="VIK">Vikings</option>
      <option value="HWL">Howl</option>
      <option value="CHU">Charged Up</option>
      <option value="EXT">Exterior IO9</option>
      <option value="INT">Interior IO9</option>
      <option value="ELBR">Elbow Room</option>
      <option value="CWBY">Cowboy</option>
      <option value="BAP">Build And Price</option>
      <option value="RAQ">Request A Quote</option>
      <option value="STD">Schedule Test Drive</option>
      <option value="SI">Search Inventory</option>
      <option value="ABW">America's Best Warranty</option>
      <option value="NAV">Navigation Screen</option>
      <option value="SEW">Safe Exit Warning</option>
      <option value="TRUNK">Hands Free Smart Trunk</option>
      <option value="DISPLAY">Display Screen</option>
      <option value="MPG">MPG</option>
      <option value="RSPA">Remote Smart Parking Assist</option>
      <option value="BSVM">Blind Spot View Monitor</option>
      <option value="CARGO">Cargo Room</option>
      <option value="RANGE">Range</option>
      <option value="HEADUP">Head-Up Display</option>
      <option value="CABIN">Cabin/Interior Space</option>
      <option value="ADVSAF">Advanced Safety Features</option>
      <option value="FINGER">Fingerprint Recognition</option>
      <option value="LEGROOM">Spacious Legroom</option>
      <option value="LIFTGATE">Hands-Free Smart Power Liftgate</option>
      <option value="SFE">Safe Exit Assist</option>
      <option value="AWD">HTRAC AWD</option>
      <option value="TONNEAU">Tonneau Bed Cover</option>
      <option value="CHARGE">Ultra-Fast Charging</option>
      <option value="2YRCHARGE">2 Years Unlimited Charging</option>
      <option value="V2L">Vehicle-to-Load</option>
      <option value="TORQUE">Torque</option>
      <option value="NGRIN">N Grin Boost</option>
      <option value="EVB">Electric Battery Warranty</option>
      <option value="DESIGN">Design</option>
      <option value="CARPLAY">Apple CarPlay/Android Auto</option>
      <option value="HPOWER">Horsepower</option>
      <option value="VFS">Ventilated Front Seats</option>
      <option value="DIGKEY">Digital Key 2</option>
      <option value="SEATS">3rd Row Heated Seats/3rd Row</option>
      <option value="BOSE">Bose Audio</option>
      <option value="TOWING">Towing Capacity</option>
      <option value="LIGHTING">Ambient Lighting</option>
      <option value="STEER">Heated Steering Wheel</option>
      <option value="IIHS">IIHS Top Safety Pick/+ Award</option>
      <option value="WPCA">World Performance Car Award</option>
      <option value="ETD">Experience the Difference (Mobile)</option>
      <option value="EVMOB">EV Messaging (Mobile)</option>
      <option value="HCM">Hyundai Complimentary Maintenance</option>
      <option value="FEA">Multiple Features</option>
      <option value="COM">Multiple Features (Competitive)</option>
      <option value="WAR">Warranty</option>
      <option value="INSP">Inspection</option>
      <option value="RA">Roadside Assistance</option>
      <option value="FIND">Find yours</option>
      <option value="HURRY">Hurry in</option>
      <option value="TIME">No time like today</option>
      <option value="LTSI">Let That Sink In</option>
      <option value="DOU">Donuts</option>
      <option value="KTT">Kick the Tires</option>
    </select>
  </div>

  <!-- MODEL YEAR -->
  <div class="field-group">
    <label for="model_year">Model Year</label>
    <select id="model_year">
      <option value="">-- Select Model Year --</option>
      <option value="MY24">MY24</option>
      <option value="MY25">MY25</option>
      <option value="MY26">MY26</option>
      <option value="MY27">MY27</option>
      <option value="MY28">MY28</option>
      <option value="MY29">MY29</option>
      <option value="MY30">MY30</option>
    </select>
  </div>

  <!-- MODEL NAME -->
  <div class="field-group">
    <label for="model_name">Model Name</label>
    <select id="model_name">
      <option value="">-- Select Model --</option>
      <option value="AFL">Alternative Fuel</option>
      <!-- Elantra -->
      <option value="ELA">Elantra ICE</option>
      <option value="EHV">Elantra HEV</option>
      <option value="ELN">Elantra N</option>
      <option value="EGT">Elantra GT</option>
      <!-- Ioniq -->
      <option value="IO5">Ioniq 5</option>
      <option value="ION">Ioniq 5 N</option>
      <option value="IO6">Ioniq 6</option>
      <option value="IO9">Ioniq 9</option>
      <!-- Kona -->
      <option value="KON">Kona ICE</option>
      <option value="KEV">Kona EV</option>
      <!-- Nexo -->
      <option value="NEX">Nexo</option>
      <!-- Palisade -->
      <option value="PAL">Palisade ICE</option>
      <option value="PHE">Palisade HEV</option>
      <!-- Santa Cruz -->
      <option value="SCZ">Santa Cruz</option>
      <!-- Santa Fe -->
      <option value="SFN">Santa Fe ICE</option>
      <option value="SHV">Santa Fe HEV</option>
      <!-- Sonata -->
      <option value="SON">Sonata</option>
      <option value="HYB">Sonata HEV</option>
      <!-- Tucson -->
      <option value="TUC">Tucson ICE</option>
      <option value="THV">Tucson HEV</option>
      <option value="TPV">Tucson PHEV</option>
      <!-- Venue -->
      <option value="VEN">Venue</option>
      <!-- Multiple Models -->
      <option value="MLM">Multiple Models</option>
    </select>
  </div>

  <!-- OFFER BUILDER -->
  <h2>Offer Builder</h2>
  <div class="offer-builder">
    <div class="hint">
      Build up to three offer segments and operators (<code>+</code> or <code>|</code>).  
      Examples this can produce: <code>2.5BC</code>, <code>3.99APR72</code>, <code>0APR60+0P90+0.5BC</code>, <code>L229+7.5EVBC+CI</code>, <code>2.99APR60|1.99APR48</code>.
    </div>

    <!-- Segment 1 -->
    <div class="segment-row">
      <span class="segment-label">Segment 1</span>
      <select id="seg1Type">
        <option value="">-- Type --</option>
        <option value="APR">APR</option>
        <option value="LEASE">Lease (Lxxx)</option>
        <option value="SD000">Lease: SD000</option>
        <option value="CASH">Cash / Savings</option>
        <option value="PAYHOL">0 Payments for X Days</option>
        <option value="CI">Charger + Installation (CI)</option>
      </select>

      <input id="seg1AprRate" type="text" placeholder="APR % (e.g. 2.99)" />
      <input id="seg1AprMonths" type="text" placeholder="Months (e.g. 60)" />

      <input id="seg1LeaseAmount" type="text" placeholder="Lease $ (e.g. 239)" />

      <input id="seg1CashAmount" type="text" placeholder="$ Cash (e.g. 2,500)" />
      <select id="seg1CashType">
        <option value="">Cash Type</option>
        <option value="BC">Bonus Cash</option>
        <option value="DC">Dealer Cash</option>
        <option value="SEC">Sales Event Cash</option>
        <option value="TS">Total Savings</option>
        <option value="EVBC">EV Bonus Cash</option>
      </select>
      <label class="inline-hint">
        <input type="checkbox" id="seg1CashUp" /> UP to
      </label>

      <input id="seg1PayDays" type="text" placeholder="Days (e.g. 90)" />
    </div>

    <!-- Operator between 1 & 2 -->
    <div class="segment-row">
      <span class="segment-label">Op 1–2</span>
      <select id="op1" class="operator-select">
        <option value="">(none)</option>
        <option value="+">+</option>
        <option value="|">|</option>
      </select>
      <span class="inline-hint">Join Segment 1 and 2</span>
    </div>

    <!-- Segment 2 -->
    <div class="segment-row">
      <span class="segment-label">Segment 2</span>
      <select id="seg2Type">
        <option value="">-- Type --</option>
        <option value="APR">APR</option>
        <option value="LEASE">Lease (Lxxx)</option>
        <option value="SD000">Lease: SD000</option>
        <option value="CASH">Cash / Savings</option>
        <option value="PAYHOL">0 Payments for X Days</option>
        <option value="CI">Charger + Installation (CI)</option>
      </select>

      <input id="seg2AprRate" type="text" placeholder="APR % (e.g. 1.99)" />
      <input id="seg2AprMonths" type="text" placeholder="Months (e.g. 48)" />

      <input id="seg2LeaseAmount" type="text" placeholder="Lease $ (e.g. 239)" />

      <input id="seg2CashAmount" type="text" placeholder="$ Cash (e.g. 2,500)" />
      <select id="seg2CashType">
        <option value="">Cash Type</option>
        <option value="BC">Bonus Cash</option>
        <option value="DC">Dealer Cash</option>
        <option value="SEC">Sales Event Cash</option>
        <option value="TS">Total Savings</option>
        <option value="EVBC">EV Bonus Cash</option>
      </select>
      <label class="inline-hint">
        <input type="checkbox" id="seg2CashUp" /> UP to
      </label>

      <input id="seg2PayDays" type="text" placeholder="Days (e.g. 90)" />
    </div>

    <!-- Operator between 2 & 3 -->
    <div class="segment-row">
      <span class="segment-label">Op 2–3</span>
      <select id="op2" class="operator-select">
        <option value="">(none)</option>
        <option value="+">+</option>
        <option value="|">|</option>
      </select>
      <span class="inline-hint">Join Segment 2 and 3</span>
    </div>

    <!-- Segment 3 -->
    <div class="segment-row">
      <span class="segment-label">Segment 3</span>
      <select id="seg3Type">
        <option value="">-- Type --</option>
        <option value="APR">APR</option>
        <option value="LEASE">Lease (Lxxx)</option>
        <option value="SD000">Lease: SD000</option>
        <option value="CASH">Cash / Savings</option>
        <option value="PAYHOL">0 Payments for X Days</option>
        <option value="CI">Charger + Installation (CI)</option>
      </select>

      <input id="seg3AprRate" type="text" placeholder="APR % (e.g. 0.99)" />
      <input id="seg3AprMonths" type="text" placeholder="Months (e.g. 60)" />

      <input id="seg3LeaseAmount" type="text" placeholder="Lease $ (e.g. 229)" />

      <input id="seg3CashAmount" type="text" placeholder="$ Cash (e.g. 7,500)" />
      <select id="seg3CashType">
        <option value="">Cash Type</option>
        <option value="BC">Bonus Cash</option>
        <option value="DC">Dealer Cash</option>
        <option value="SEC">Sales Event Cash</option>
        <option value="TS">Total Savings</option>
        <option value="EVBC">EV Bonus Cash</option>
      </select>
      <label class="inline-hint">
        <input type="checkbox" id="seg3CashUp" /> UP to
      </label>

      <input id="seg3PayDays" type="text" placeholder="Days (e.g. 90)" />
    </div>

    <!-- Offer code preview + hidden field used in taxonomy -->
    <div class="segment-row">
      <span class="segment-label">Offer Code</span>
      <input id="offerCodeDisplay" type="text" placeholder="e.g. 2.99APR60|2.5BC" readonly style="min-width:260px;" />
      <input type="hidden" id="offerCode" />
    </div>

    <div class="hint">
      Examples you can build:
      <ul>
        <li><code>2.5BC</code>, <code>2.5DC</code>, <code>2.5SEC</code>, <code>2.5TS</code>, <code>2.5TS+CI</code>, <code>7.5EVBC</code></li>
        <li><code>3.99APR72</code>, <code>0APR60+0P90</code>, <code>3.99APR72+CI</code>, <code>3.99APR72+0.5BC+CI</code></li>
        <li><code>L239</code>, <code>L249+1.5BC</code>, <code>SD000</code>, <code>L229+7.5EVBC+CI</code></li>
        <li><code>2.99APR60+2.5BC</code>, <code>2.99APR60|2.5BC</code>, <code>0APR60+0P90+0.5BC</code></li>
        <li><code>0APR60+0P90+UP2.5BC</code>, <code>0APR60+0P90|UP2.5BC</code></li>
        <li><code>1.99APR48+L239</code>, <code>1.99APR48|L239</code>, <code>2.99APR60|1.99APR48</code>, <code>0.99APR60|7.5EVBC</code></li>
      </ul>
    </div>
  </div>

  <!-- MARKET -->
  <div class="field-group">
    <label for="market">Market / DMA</label>
    <select id="market">
      <option value="">-- Select Market --</option>
      <option value="ATL">Atlanta</option>
      <option value="LAX">Los Angeles</option>
      <option value="NYC">New York</option>
      <option value="NA">National</option>
    </select>
  </div>

  <!-- AGENCY -->
  <div class="field-group">
    <label for="agency">Agency / Partner</label>
    <select id="agency">
      <option value="">-- Select Agency --</option>
      <option value="GM">General Market Agency</option>
      <option value="HM">Hyundai In-house</option>
      <option value="PM">Performance Media Partner</option>
    </select>
  </div>

  <!-- RESERVED / SUFFIX -->
  <div class="field-group">
    <label for="reserved">Reserved / Suffix</label>
    <select id="reserved">
      <option value="">-- Select Suffix --</option>
      <option value="NA">Not Applicable</option>
      <option value="A">Version A</option>
      <option value="B">Version B</option>
    </select>
  </div>

  <!-- OUTPUT -->
  <div class="code-output">
    <div><strong>Generated Taxonomy String:</strong></div>
    <code id="taxonomyCode">(select values above)</code>
    <div class="hint">
      This updates live as you change fields. Copy + paste into your trafficking sheet.
    </div>
  </div>

  <script>
    // Order matters: this is how the final string will be assembled.
    // Adjust this to match your final taxonomy spec (e.g., add offer end date, demo market, length later).
    const fieldOrder = [
      "region",
      "media",
      "initiative",
      "title",
      "model_year",
      "model_name",
      "offerCode",   // dynamic offer code built from segments above
      "market",
      "agency",
      "reserved"
    ];

    function updateTaxonomy() {
      const parts = fieldOrder
        .map(id => {
          const el = document.getElementById(id);
          return el ? (el.value || "").trim() : "";
        })
        .filter(Boolean); // remove empty selections

      const code = parts.length > 0
        ? parts.join("_")
        : "(select values above)";

      document.getElementById("taxonomyCode").textContent = code;
    }

    function buildSegmentCode(prefix) {
      const typeEl = document.getElementById(prefix + "Type");
      const type = typeEl ? typeEl.value : "";

      if (!type) return "";

      // Common helpers
      const cleanNumeric = (val) => val.replace(/[^0-9.]/g, "");
      const cleanInt = (val) => val.replace(/[^0-9]/g, "");

      if (type === "APR") {
        const rateInput = document.getElementById(prefix + "AprRate");
        const monthsInput = document.getElementById(prefix + "AprMonths");
        const rawRate = rateInput ? rateInput.value : "";
        const rawMonths = monthsInput ? monthsInput.value : "";
        const rateStr = cleanNumeric(rawRate);
        const monthsStr = cleanInt(rawMonths);
        if (!rateStr || !monthsStr) return "";
        return rateStr + "APR" + monthsStr;
      }

      if (type === "LEASE") {
        const leaseInput = document.getElementById(prefix + "LeaseAmount");
        const rawLease = leaseInput ? leaseInput.value : "";
        const leaseStr = cleanInt(rawLease);
        if (!leaseStr) return "";
        return "L" + leaseStr;
      }

      if (type === "SD000") {
        return "SD000";
      }

      if (type === "CASH") {
        const amtInput = document.getElementById(prefix + "CashAmount");
        const typeSelect = document.getElementById(prefix + "CashType");
        const upCheckbox = document.getElementById(prefix + "CashUp");

        const rawAmt = amtInput ? amtInput.value : "";
        const rawType = typeSelect ? typeSelect.value : "";
        if (!rawAmt || !rawType) return "";

        const numeric = parseFloat(cleanNumeric(rawAmt));
        if (isNaN(numeric) || numeric <= 0) return "";

        const thousands = numeric / 1000;
        const thousandsStr = thousands.toFixed(1); // e.g., 2500 -> 2.5

        const prefixUp = upCheckbox && upCheckbox.checked ? "UP" : "";
        return prefixUp + thousandsStr + rawType;
      }

      if (type === "PAYHOL") {
        const daysInput = document.getElementById(prefix + "PayDays");
        const rawDays = daysInput ? daysInput.value : "";
        const daysStr = cleanInt(rawDays);
        if (!daysStr) return "";
        // Encoded as 0P90 (0 payments for 90 days)
        return "0P" + daysStr;
      }

      if (type === "CI") {
        return "CI";
      }

      return "";
    }

    function buildOfferCode() {
      const s1 = buildSegmentCode("seg1");
      const s2 = buildSegmentCode("seg2");
      const s3 = buildSegmentCode("seg3");

      const op1El = document.getElementById("op1");
      const op2El = document.getElementById("op2");
      const op1 = op1El ? op1El.value : "";
      const op2 = op2El ? op2El.value : "";

      const parts = [];

      if (s1) {
        parts.push(s1);
      }

      if (s2) {
        const op = (op1 && parts.length > 0) ? op1 : "";
        parts.push(op + s2);
      }

      if (s3) {
        const op = (op2 && parts.length > 0) ? op2 : "";
        parts.push(op + s3);
      }

      const finalOffer = parts.join("");

      const hidden = document.getElementById("offerCode");
      const display = document.getElementById("offerCodeDisplay");

      if (hidden) hidden.value = finalOffer;
      if (display) display.value = finalOffer;

      updateTaxonomy();
    }

    // Attach listeners for non-offer fields
    fieldOrder.forEach(id => {
      const el = document.getElementById(id);
      if (el && id !== "offerCode") {
        el.addEventListener("change", updateTaxonomy);
      }
    });

    // Attach listeners for offer builder inputs
    const offerTextIds = [
      "seg1AprRate", "seg1AprMonths", "seg1LeaseAmount", "seg1CashAmount", "seg1PayDays",
      "seg2AprRate", "seg2AprMonths", "seg2LeaseAmount", "seg2CashAmount", "seg2PayDays",
      "seg3AprRate", "seg3AprMonths", "seg3LeaseAmount", "seg3CashAmount", "seg3PayDays"
    ];
    const offerSelectIds = [
      "seg1Type", "seg1CashType",
      "seg2Type", "seg2CashType",
      "seg3Type", "seg3CashType",
      "op1", "op2"
    ];
    const offerCheckboxIds = [
      "seg1CashUp", "seg2CashUp", "seg3CashUp"
    ];

    offerTextIds.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener("input", buildOfferCode);
      }
    });

    offerSelectIds.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener("change", buildOfferCode);
      }
    });

    offerCheckboxIds.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener("change", buildOfferCode);
      }
    });

    // Initial render
    buildOfferCode();
  </script>
</body>
</html>
